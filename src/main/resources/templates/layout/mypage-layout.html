<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      th:fragment="layout(title, content, css, script)">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" th:href="@{/images/logo_icon.png}" type="image/png">
    <title th:replace="${title}">마이페이지 | LearnI</title>

    <link rel="stylesheet" th:href="@{/css/common/base.css}">
    <link rel="stylesheet" th:href="@{/css/common/header.css}">
    <link rel="stylesheet" th:href="@{/css/common/footer.css}">
    <link rel="stylesheet" th:href="@{/css/common/mainnav.css}">
    <link rel="stylesheet" th:href="@{/css/home/chatbot.css}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

    <!--페이지별 css-->
    <th:block th:replace="${css}"></th:block>
</head>

<body>

<div th:replace="fragments/header :: site-header"></div>

<!-- 모바일 헤더 네비게이션 -->
<div class="mobile-header-nav">
    <!-- 프로필 섹션 -->
    <div class="mobile-profile-section">
        <div class="mobile-photo">
            <img th:src="${user != null && user.profileImageUrl != null ? user.profileImageUrl : '/images/logo_icon.png'}" 
                 alt="프로필 이미지"
                 onerror="this.src='/images/logo_icon.png'">
        </div>
        <div class="mobile-profile-info">
            <p class="mobile-nickname" th:text="${user != null && user.nickname != null ? user.nickname : '닉네임'}">닉네임</p>
            <p class="mobile-user-id" th:text="${user != null && user.email != null ? user.email : '아이디'}">아이디</p>
        </div>
    </div>

    <!-- 가로 네비게이션 -->
    <nav class="mypage-mobile-nav">
        <ul>
            <li><a th:href="@{/mypage}" class="nav-link" data-path="/mypage">대시보드</a></li>
            <li><a th:href="@{/mypage/settings}" class="nav-link" data-path="/mypage/settings">개인정보 수정</a></li>
            <li><a th:href="@{/mypage/courses}" class="nav-link" data-path="/mypage/courses">내 학습 강의</a></li>
            <li><a th:href="@{/mypage/qa}" class="nav-link" data-path="/mypage/qa">강의 Q&A</a></li>
            <li><a th:href="@{/mypage/purchase}" class="nav-link" data-path="/mypage/purchase">구매 / 혜택</a></li>
        </ul>
    </nav>
</div>

<div class="layout-container">
    <!-- 데스크탑 사이드바 -->
    <aside class="mypage-sidebar">
        <div class="profile-box">
            <div class="photo">
                <img th:src="${user != null && user.profileImageUrl != null ? user.profileImageUrl : '/images/logo_icon.png'}" 
                     alt="프로필 이미지"
                     onerror="this.src='/images/logo_icon.png'">
            </div>
            <p class="nickname" th:text="${user != null && user.nickname != null ? user.nickname : '닉네임'}">닉네임</p>
            <p class="user-id" th:text="${user != null && user.email != null ? user.email : '아이디'}">아이디</p>
        </div>
        <nav class="mypage-nav">
            <ul>
                <li><a th:href="@{/mypage}">대시보드</a></li>
                <li><a th:href="@{/mypage/settings}">개인정보 수정</a></li>
                <li><a th:href="@{/mypage/courses}">내 학습 강의</a></li>
                <li><a th:href="@{/mypage/qa}">강의 Q&A</a></li>
                <li><a th:href="@{/mypage/purchase}">구매 / 혜택</a></li>
            </ul>
        </nav>
    </aside>

    <main class="layout-content">
        <div th:replace="${content}"></div>
    </main>
</div>

<!-- 챗봇(모든 페이지 공통 요소) -->
<div th:replace="fragments/chatbot :: chatbot"></div>

<div th:replace="fragments/footer :: footer"></div>

<!--챗봇 공통 js-->
<script th:src="@{/js/home/chatbot.js}"></script>

<!-- 마이페이지 네비게이션 active 클래스 처리 -->
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const currentPath = window.location.pathname;
        const navLinks = document.querySelectorAll('.mypage-mobile-nav .nav-link');
        
        navLinks.forEach(link => {
            const linkPath = link.getAttribute('data-path');
            // /mypage/dashboard 또는 /mypage로 접근 시 대시보드 활성화
            if (linkPath === '/mypage' && (currentPath === '/mypage' || currentPath === '/mypage/')) {
                link.classList.add('active');
            } else if (linkPath !== '/mypage' && currentPath.startsWith(linkPath)) {
                link.classList.add('active');
            }
        });
    });
</script>

<th:block th:replace="${script}"></th:block>

</body>
</html>
