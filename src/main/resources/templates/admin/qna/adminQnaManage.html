<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      th:replace="~{layout/adminLayout :: layout(
        ~{::title},
        ~{::content},
        ~{::css},
        ~{::script}
      )}">

<th:block th:fragment="css">
    <link rel="stylesheet" th:href="@{/css/admin/adminQna.css}">
</th:block>

<!-- ‚úÖ Í∏∞Ï°¥Ïóê Ïó¨Í∏∞ Îì§Ïñ¥ÏûàÎçò <script>...</script> ÏΩîÎìúÎäî Ï†ÑÎ∂Ä Ï†úÍ±∞ÌïòÍ≥†
     Ïô∏Î∂Ä JS ÌååÏùºÎßå Î°úÎìúÌïòÎèÑÎ°ù Î≥ÄÍ≤Ω -->
<th:block th:fragment="script">
    <script th:src="@{/js/admin/adminQna.js}"></script>
</th:block>

<head>
    <title>Q&A Í¥ÄÎ¶¨</title>
</head>

<body>
<section th:fragment="content" class="admin-content-inner">
    <div class="admin-qna-container">
        <h2>Q&A Í¥ÄÎ¶¨</h2>

        <div th:if="${successMessage}" class="alert alert-success" th:text="${successMessage}"></div>
        <div th:if="${errorMessage}" class="alert alert-error" th:text="${errorMessage}"></div>

        <!-- ÏÉÅÎã® Í≤ÄÏÉâ ÏòÅÏó≠ -->
        <div class="filters">
            <form method="get" th:action="@{/admin/qna}" class="filter-form">

                <select name="searchField" class="filter-select qnaid-select">
                    <option value="QNA_ID" th:selected="${searchField == 'QNA_ID'}">Q&AÎ≤àÌò∏</option>
                    <option value="TITLE"  th:selected="${searchField == 'TITLE'}">Í∞ïÏ¢åÎ™Ö/Ï†úÎ™©</option>
                    <option value="WRITER" th:selected="${searchField == 'WRITER'}">ÏûëÏÑ±Ïûê</option>
                </select>

                <input type="hidden" name="type" th:value="${currentType}">
                <input type="hidden" name="status" th:value="${currentStatus}">

                <input type="text" name="search" class="search-input"
                       placeholder="Í≤ÄÏÉâÏñ¥Î•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî"
                       th:value="${searchKeyword}">

                <input type="hidden" name="page" value="1">
                <input type="hidden" name="size" th:value="${pageSize}">

                <button type="submit" class="btn-search">Í≤ÄÏÉâ</button>
                <a th:href="@{/admin/qna(size=${pageSize})}" class="btn-reset">Ï¥àÍ∏∞Ìôî</a>

                <!-- ‚úÖ (ÏöîÏ≤≠ÏÇ¨Ìï≠) SUB_ADMIN Î¨∏Íµ¨ Ï†úÍ±∞ -->
            </form>
        </div>

        <div class="table-wrap">
            <table class="qna-table">
                <thead>
                <tr>
                    <th class="th-filter">
                        Íµ¨Î∂Ñ
                        <span class="filter-icon" data-key="type">üîΩ</span>
                        <div class="filter-popup" data-popup="type">
                            <a class="popup-link"
                               th:href="@{/admin/qna(page=1,size=${pageSize},type=LECTURE,status=${currentStatus},searchField=${searchField},search=${searchKeyword})}">
                                Í∞ïÏùò Q&A
                            </a>

                            <a class="popup-link"
                               th:href="@{/admin/qna(page=1,size=${pageSize},type=SITE,status=${currentStatus},searchField=${searchField},search=${searchKeyword})}"
                               th:if="${isAdmin}">
                                Ï†ÑÏ≤¥ Q&A
                            </a>

                            <a class="popup-link"
                               th:href="@{/admin/qna(page=1,size=${pageSize},status=${currentStatus},searchField=${searchField},search=${searchKeyword})}"
                               th:if="${isAdmin}">
                                Ï†ÑÏ≤¥(Í∞ïÏùò+Ï†ÑÏ≤¥)
                            </a>
                        </div>
                    </th>

                    <th>Q&AÎ≤àÌò∏</th>
                    <th>Í∞ïÏ¢åÎ™Ö/Ï†úÎ™©</th>
                    <th>ÏûëÏÑ±Ïûê</th>
                    <th>ÏÉÅÌÉú</th>
                    <th>Îì±Î°ùÏùº</th>
                </tr>
                </thead>

                <tbody>
                <th:block th:each="q : ${qnas}">
                    <tr class="main-row">
                        <td th:text="${q.typeLabel}">Í∞ïÏùò Q&A</td>
                        <td th:text="${q.qnaId}">1</td>

                        <td class="title-cell"
                            th:text="${q.courseId != null
                            ? (q.courseTitle + ' / ' + q.questionTitleDisplay)
                            : q.questionTitleDisplay}">
                        </td>


                        <td th:text="${q.questionUserName}">ÏûëÏÑ±Ïûê</td>

                        <td>
                            <div class="status-badge-wrap"
                                 th:classappend="${isAdmin or isSubAdmin} ? 'can-click' : ''">

                                <span class="badge status-badge-click"
                                      th:classappend="${q.statusLabel == 'ACTIVE'} ? 'badge-active' : 'badge-pass'"
                                      th:text="${q.statusLabel}">
                                </span>

                                <div class="status-action-popup" th:if="${isAdmin or (isSubAdmin and q.courseId != null)}">
                                    <form th:action="@{'/admin/qna/' + ${q.qnaId} + '/status'}" method="post" class="status-action-form">
                                        <input type="hidden" name="type" th:value="${currentType}">
                                        <input type="hidden" name="status" th:value="${currentStatus}">
                                        <input type="hidden" name="searchField" th:value="${searchField}">
                                        <input type="hidden" name="search" th:value="${searchKeyword}">
                                        <input type="hidden" name="page" th:value="${currentPage}">
                                        <input type="hidden" name="size" th:value="${pageSize}">

                                        <button type="submit" name="newStatus" value="ACTIVE" class="popup-btn">ACTIVEÎ°ú Î≥ÄÍ≤Ω</button>
                                        <button type="submit" name="newStatus" value="PASS" class="popup-btn">PASSÎ°ú Î≥ÄÍ≤Ω</button>
                                    </form>
                                </div>
                            </div>
                        </td>

                        <td th:text="${q.questionCreatedAt != null ? #temporals.format(q.questionCreatedAt,'yyyy-MM-dd') : '-'}">-</td>
                    </tr>

                    <tr class="detail-row" style="display:none;">
                        <td colspan="6">
                            <div class="detail-inner">
                                <div class="detail-meta">
                                    <span><b>Íµ¨Î∂Ñ</b> : <span th:text="${q.typeLabel}"></span></span>
                                    <span><b>ÏûëÏÑ±Ïûê</b> : <span th:text="${q.questionUserName}"></span></span>
                                    <span><b>Ïù¥Î©îÏùº</b> : <span th:text="${q.questionUserEmail}"></span></span>
                                    <span th:if="${q.courseTitle != null}">
                                        <b>Í∞ïÏùò</b> : <span th:text="${q.courseTitle}"></span>
                                    </span>
                                </div>

                                <div class="detail-title" th:text="${q.questionTitleDisplay}"></div>

                                <div class="detail-body">
                                    <div class="question-box">
                                        <div class="box-title">ÏßàÎ¨∏</div>
                                        <div class="box-content" th:text="${q.questionContent}">ÏßàÎ¨∏ ÎÇ¥Ïö©</div>
                                    </div>

                                    <div class="answer-box">
                                        <div class="box-title">ÎãµÎ≥Ä</div>

                                        <th:block th:if="${isAdmin or (isSubAdmin and q.courseId != null)}">
                                            <form th:action="@{'/admin/qna/' + ${q.qnaId} + '/save'}"
                                                  method="post" class="answer-form">

                                                <textarea name="content" rows="6"
                                                          placeholder="ÎãµÎ≥ÄÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî"
                                                          th:text="${q.answerContent}"></textarea>

                                                <div class="status-inline">
                                                    <label class="status-label">ÏÉÅÌÉú</label>
                                                    <select name="newStatus" class="status-select">
                                                        <option value="ACTIVE" th:selected="${q.statusLabel == 'ACTIVE'}">ACTIVE</option>
                                                        <option value="PASS" th:selected="${q.statusLabel == 'PASS'}">PASS</option>
                                                    </select>
                                                </div>

                                                <input type="hidden" name="type" th:value="${currentType}">
                                                <input type="hidden" name="status" th:value="${currentStatus}">
                                                <input type="hidden" name="searchField" th:value="${searchField}">
                                                <input type="hidden" name="search" th:value="${searchKeyword}">
                                                <input type="hidden" name="page" th:value="${currentPage}">
                                                <input type="hidden" name="size" th:value="${pageSize}">

                                                <div class="btn-row">
                                                    <button type="submit" class="btn-primary">ÏàòÏ†ï</button>

                                                    <button type="submit"
                                                            class="btn-danger"
                                                            th:formaction="@{'/admin/qna/' + ${q.qnaId} + '/delete'}"
                                                            formmethod="post"
                                                            onclick="return confirm('Ï†ïÎßê ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?');">
                                                        ÏÇ≠Ï†ú
                                                    </button>
                                                </div>
                                            </form>
                                        </th:block>

                                        <th:block th:if="${!(isAdmin or (isSubAdmin and q.courseId != null))}">
                                            <div class="box-content"
                                                 th:text="${q.answerContent != null ? q.answerContent : 'Îì±Î°ùÎêú ÎãµÎ≥ÄÏù¥ ÏóÜÏäµÎãàÎã§.'}"></div>
                                            <div class="no-permission">Í∂åÌïúÏù¥ ÏóÜÏäµÎãàÎã§.</div>
                                        </th:block>

                                    </div>
                                </div>
                            </div>
                        </td>
                    </tr>
                </th:block>

                <tr th:if="${qnas == null or #lists.isEmpty(qnas)}">
                    <td colspan="6" class="empty">Q&AÍ∞Ä ÏóÜÏäµÎãàÎã§.</td>
                </tr>
                </tbody>
            </table>
        </div>

        <div class="pagination" th:if="${totalPages > 1}">
            <a th:if="${startPage > 1}"
               th:href="@{/admin/qna(page=${startPage-1}, size=${pageSize}, type=${currentType}, status=${currentStatus}, searchField=${searchField}, search=${searchKeyword})}"
               class="page-link">Ïù¥Ï†Ñ</a>

            <span th:each="i : ${#numbers.sequence(startPage, endPage)}" class="page-number">
                <a th:if="${i != currentPage}"
                   th:href="@{/admin/qna(page=${i}, size=${pageSize}, type=${currentType}, status=${currentStatus}, searchField=${searchField}, search=${searchKeyword})}"
                   th:text="${i}">1</a>
                <strong th:if="${i == currentPage}" th:text="${i}">1</strong>
            </span>

            <a th:if="${endPage < totalPages}"
               th:href="@{/admin/qna(page=${endPage+1}, size=${pageSize}, type=${currentType}, status=${currentStatus}, searchField=${searchField}, search=${searchKeyword})}"
               class="page-link">Îã§Ïùå</a>
        </div>

        <div class="summary-total">
            Ï¥ù <strong th:text="${totalCount}">0</strong>Í∞ú
        </div>

    </div>
</section>
</body>
</html>
