<html xmlns:th="http://www.thymeleaf.org"
      th:replace="~{
        layout/mypageLayout :: layout(
          ~{::title},
          ~{::content},
          ~{::css},
          ~{::script}
        )
      }">

<head>
    <title th:fragment="title">ë§ˆì´ í”„ë¡œí•„</title>

    <th:block th:fragment="css">
        <!-- mypage.cssì™€ mypageNavbar.cssëŠ” layoutì—ì„œ ì´ë¯¸ ë¡œë“œë¨ -->
        <link rel="stylesheet" th:href="@{/css/mypage/profile.css}">
    </th:block>

    <th:block th:fragment="script">
        <!-- Chart.js ë¼ì´ë¸ŒëŸ¬ë¦¬ -->
        <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
        <!-- Thymeleafì—ì„œ ì „ë‹¬ëœ ë°ì´í„°ë¥¼ JavaScriptë¡œ ì „ë‹¬ -->
        <script th:if="${skillChart != null}">
            window.savedSkillChart = {
                skillNames: /*[[${skillChart.skillNames}]]*/ [],
                skillLevels: /*[[${skillChart.skillLevels}]]*/ []
            };
            window.savedAnalysis = /*[[${githubAnalysis}]]*/ null;
            console.log('Thymeleafì—ì„œ ì „ë‹¬ëœ skillChart:', window.savedSkillChart);
            console.log('Thymeleafì—ì„œ ì „ë‹¬ëœ analysis:', window.savedAnalysis);
        </script>
        <!-- í”„ë¡œí•„ í˜ì´ì§€ JavaScript -->
        <script th:src="@{/js/mypage/myProfile.js}"></script>
    </th:block>
</head>

<body>

<div th:fragment="content">
    <h1 class="page-title">ë§ˆì´ í”„ë¡œí•„</h1>

    <div class="profile-container">
        <!-- í”„ë¡œí•„ ìƒì„¸ ì„¹ì…˜ -->
        <section class="profile-section profile-detail-section">
            <h2 class="section-title">í”„ë¡œí•„ ìƒì„¸</h2>
            <div class="profile-detail-content">
                <div class="profile-photo-large">
                    <img th:src="${profile != null && profile.profileImageUrl != null ? profile.profileImageUrl : '/images/logo_icon.png'}" 
                         alt="í”„ë¡œí•„ ì´ë¯¸ì§€"
                         onerror="this.src='/images/logo_icon.png'">
                </div>
                <div class="profile-info">
                    <p class="profile-nickname" th:text="${profile != null && profile.nickname != null ? profile.nickname : 'ë‹‰ë„¤ì„'}">ë‹‰ë„¤ì„</p>
                    <p class="profile-id" th:text="'@' + ${profile != null && profile.email != null ? profile.email : 'ì•„ì´ë””'}">@ì•„ì´ë””</p>
                    <div class="profile-details">
                        <div class="detail-item" th:if="${profile != null && profile.name != null}">
                            <span class="detail-label">ì´ë¦„ :</span>
                            <span class="detail-value" th:text="${profile.name}">ì „í¬ì—°</span>
                        </div>
                        <div class="detail-item" th:if="${profile != null && profile.email != null}">
                            <span class="detail-label">ì´ë©”ì¼ :</span>
                            <span class="detail-value" th:text="${profile.email}">heeyeon@naver.com</span>
                        </div>
                        <div class="detail-item" th:if="${profile != null && profile.region != null}">
                            <span class="detail-label">ì§€ì—­ :</span>
                            <span class="detail-value" th:text="${profile.region}">ì„œìš¸</span>
                        </div>
                        <div class="detail-item" th:if="${profile != null && profile.githubUrl != null}">
                            <span class="detail-label">ê¹ƒí—ˆë¸Œ ë§í¬ :</span>
                            <a th:href="${profile.githubUrl}" target="_blank" class="detail-value github-link" th:text="${profile.githubUrl}">github.com/heeyeon</a>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- ìˆ˜ë£Œì¦ ì„¹ì…˜ -->
        <section class="profile-section certificate-section">
            <div class="section-header">
                <h2 class="section-title">ìˆ˜ë£Œì¦</h2>
                <button class="view-all-link" id="view-all-certificates-btn" style="background: none; border: none; cursor: pointer; color: #666; text-decoration: none; font-size: 1.4rem;">ì „ì²´ ë³´ê¸° ></button>
            </div>
            <div class="certificate-content">
                <div th:if="${certificates != null && !certificates.isEmpty()}" class="certificate-list">
                    <div th:each="cert : ${certificates}" class="certificate-item">
                        <div class="certificate-icon">ğŸ“œ</div>
                        <div class="certificate-info">
                            <div class="certificate-title" th:text="${cert.courseTitle}">ê°•ì˜ëª…</div>
                            <div class="certificate-date" th:text="${#temporals.format(cert.issuedDate, 'yyyy. MM. dd.')}">2024. 01. 01.</div>
                        </div>
                        <a th:href="@{${cert.certificateUrl}}" class="certificate-download-btn" download>
                            ë‹¤ìš´ë¡œë“œ
                        </a>
                    </div>
                </div>
                <p th:if="${certificates == null || certificates.isEmpty()}" class="empty-message">ìˆ˜ë£Œì¦ì´ ì—†ìŠµë‹ˆë‹¤.</p>
            </div>
        </section>

        <!-- ìˆ˜ë£Œì¦ ì „ì²´ ë³´ê¸° ëª¨ë‹¬ -->
        <div class="modal-overlay" id="certificates-modal">
            <div class="modal-content certificates-modal-content">
                <div class="modal-header">
                    <h2>ìˆ˜ë£Œì¦ ì „ì²´ ë³´ê¸°</h2>
                    <button class="modal-close" id="close-certificates-modal">Ã—</button>
                </div>
                <div class="modal-body certificates-modal-body">
                    <div id="certificates-list">
                        <p class="loading-message">ìˆ˜ë£Œì¦ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- GitHub ë¶„ì„ ê²°ê³¼ ì„¹ì…˜ -->
        <section class="profile-section github-analysis-section">
            <div class="section-header">
                <h2 class="section-title">GitHub ë¶„ì„ ê²°ê³¼</h2>
                <button id="analyze-github-btn" class="btn-analyze" th:if="${profile != null && profile.githubUrl != null}">
                    ë¶„ì„í•˜ê¸°
                </button>
            </div>
            <div class="github-analysis-content" id="github-analysis-content">
                <div class="loading-message" id="github-loading" style="display: none;">
                    <p>ë¶„ì„ ì¤‘...</p>
                </div>
                <div class="analysis-result" id="github-analysis-result" style="display: none;">
                    <div class="analysis-stats">
                        <div class="stat-item">
                            <span class="stat-label">ë ˆí¬ì§€í† ë¦¬</span>
                            <span class="stat-value" id="stat-repos">0</span>
                        </div>
                        <div class="stat-item" style="position: relative;">
                            <span class="stat-label">ê°œë°œ í™œë™</span>
                            <span class="stat-value" id="stat-forks">0</span>
                            <div class="activity-tooltip" id="activity-tooltip" style="display: none;">
                                <div class="tooltip-content"></div>
                            </div>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">ì£¼ìš” ì–¸ì–´</span>
                            <span class="stat-value" id="stat-language">-</span>
                        </div>
                    </div>
                    <div class="language-list" id="language-list"></div>
                </div>
                <p class="empty-message" id="github-empty">GitHub URLì„ ë“±ë¡í•˜ê³  ë¶„ì„ì„ ì‹œì‘í•˜ì„¸ìš”.</p>
            </div>
        </section>

        <!-- ê¸°ìˆ  ìœ¡ê°í˜• ìŠ¤í‚¬ ì°¨íŠ¸ ì„¹ì…˜ -->
        <section class="profile-section skill-chart-section">
            <h2 class="section-title">ê¸°ìˆ  ìœ¡ê°í˜• ìŠ¤í‚¬ ì°¨íŠ¸</h2>
            <div class="skill-chart-content">
                <div class="chart-container" id="skill-chart-container" style="display: none;">
                    <canvas id="skill-chart"></canvas>
                </div>
                <p class="empty-message" id="skill-chart-empty">ìŠ¤í‚¬ ì°¨íŠ¸ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
            </div>
        </section>

        <!-- ì°¸ì—¬ / ì™„ë£Œ ìŠ¤í„°ë”” ì„¹ì…˜ -->
        <section class="profile-section study-section">
            <h2 class="section-title">ì°¸ì—¬ / ì™„ë£Œ ìŠ¤í„°ë””</h2>
            <div class="study-content">
                <p class="empty-message">ì°¸ì—¬í•œ ìŠ¤í„°ë””ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
            </div>
        </section>
    </div>
</div>

</body>
</html>
