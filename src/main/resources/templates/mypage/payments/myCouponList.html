<!DOCTYPE html>
<html lang="ko"
      xmlns:th="http://www.thymeleaf.org"
      th:replace="~{layout/mypageLayout :: layout(~{::title}, ~{::content}, ~{::css}, ~{::script})}">

<head>
    <!-- title -->
    <title th:fragment="title">마이페이지 - 구매 / 혜택</title>

    <!-- page css -->
    <th:block th:fragment="css">
        <link rel="stylesheet" th:href="@{/css/mypage/mypageDashboard.css}">
        <link rel="stylesheet" th:href="@{/css/mypage/mypagePurchase.css}">
    </th:block>
</head>

<body>

<div th:fragment="content">

    <div th:replace="mypage/payments/myPaymentHeader :: mypage-header('coupons')"></div>

    <div class="coupon-list">

        <div class="empty-message"
             th:if="${#lists.isEmpty(coupons)}">
            보유한 쿠폰이 없습니다.
        </div>

        <div class="coupon-card"
             th:each="coupon : ${coupons}">

            <div class="coupon-left">
                <span class="coupon-name"
                      th:text="${coupon.name}"></span>

                <p class="coupon-condition"
                   th:text="'최소 결제 ' + ${#numbers.formatInteger(coupon.minPrice, 3, 'COMMA')} + '원'">
                </p>

                <p class="coupon-expire"
                   th:text="'만료일 · ' + ${#temporals.format(coupon.expireDate, 'yyyy.MM.dd')}">
                </p>
            </div>

            <div class="coupon-right">
                <span class="discount"
                      th:text="${coupon.discountAmount} + '원'"></span>

                <span class="coupon-badge used"
                      th:if="${coupon.isUsed == 'Y'}">
                    사용 완료
                </span>

                <span class="coupon-badge expired"
                      th:if="${coupon.isUsed == 'N' and coupon.expireDate != null
                             and coupon.expireDate.isBefore(T(java.time.LocalDateTime).now())}">
                    만료
                </span>

                <span class="coupon-badge usable"
                      th:if="${coupon.isUsed == 'N' and
                             (coupon.expireDate == null
                             or coupon.expireDate.isAfter(T(java.time.LocalDateTime).now()))}">
                    사용 가능
                </span>
            </div>

        </div>
    </div>

    <!-- 페이징 -->
    <div class="pagination" th:if="${totalPages != null and totalPages > 1}">
        <a th:if="${startPage > 1}"
           th:href="@{/mypage/coupons(page=${startPage - 1}, size=${pageSize})}"
           class="page-link">
            이전
        </a>
        <span th:each="i : ${#numbers.sequence(startPage, endPage)}" class="page-number">
            <a th:if="${i != currentPage}"
               th:href="@{/mypage/coupons(page=${i}, size=${pageSize})}"
               th:text="${i}">1</a>
            <strong th:if="${i == currentPage}"
                    th:text="${i}">1</strong>
        </span>
        <a th:if="${endPage < totalPages}"
           th:href="@{/mypage/coupons(page=${endPage + 1}, size=${pageSize})}"
           class="page-link">
            다음
        </a>
    </div>

    <!-- 총 쿠폰 개수 -->
    <div class="qna-summary" th:if="${totalCount != null}">
        <p>총 <strong th:text="${totalCount}">0</strong>개의 쿠폰</p>
    </div>
</div>

<th:block th:fragment="script"></th:block>

</body>
</html>
